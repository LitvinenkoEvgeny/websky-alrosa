{"version":3,"sources":["controllers-alrosa.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","app","angular","directive","scope","controllerAs","bindToController","scopeAs","controller","$scope","backend","vm","$parent","replaceInfoInBrandList","brandsList","_","forEach","redefineRules","rules","brands","replaceWithBrand","brand","console","log","props","brandProp","extend","ready","then","JSON","parse","getAlias","error","$watch","bind","this","searchResult","newSearchResult","replaceInfo","redefineRule","routes","flight","segmentRows","segment","segmentFlight","flightsInfo","origincity","from","destinationcity","to","2","./directives/withRoute"],"mappings":"CAAY,SAASA,EAAEC,EAAEC,EAAEC,GAAG,SAASC,EAAEC,EAAEC,GAAG,IAAIJ,EAAEG,GAAG,CAAC,IAAIJ,EAAEI,GAAG,CAAC,IAAIE,EAAE,mBAAmBC,SAASA,QAAQ,IAAIF,GAAGC,EAAE,OAAOA,EAAEF,GAAE,GAAI,GAAGI,EAAE,OAAOA,EAAEJ,GAAE,GAAI,IAAIK,EAAE,IAAIC,MAAM,uBAAuBN,EAAE,KAAK,MAAMK,EAAEE,KAAK,mBAAmBF,EAAE,IAAIG,EAAEX,EAAEG,GAAG,CAACS,QAAQ,IAAIb,EAAEI,GAAG,GAAGU,KAAKF,EAAEC,QAAQ,SAASd,GAAoB,OAAOI,EAAlBH,EAAEI,GAAG,GAAGL,IAAeA,IAAIa,EAAEA,EAAEC,QAAQd,EAAEC,EAAEC,EAAEC,GAAG,OAAOD,EAAEG,GAAGS,QAAQ,IAAI,IAAIL,EAAE,mBAAmBD,SAASA,QAAQH,EAAE,EAAEA,EAAEF,EAAEa,OAAOX,IAAID,EAAED,EAAEE,IAAI,OAAOD,EAA7b,CAA4c,CAACa,EAAE,CAAC,SAAST,EAAQU,EAAOJ,GACxe,aACA,IAAIK,EAAMC,QAAQF,OAAO,OAEzBC,EAAIE,UAAU,cAAe,WACzB,MAAO,CACHC,OAAO,EACPC,aAAc,cACdC,kBAAkB,EAClBC,QAAS,KACTC,WAAY,uBAIpBP,EAAIO,WAAW,oBAAqB,CAAC,SAAU,UAE/C,SAA2BC,EAAQC,GAC/B,IAAIC,EAAKF,EAAOG,QAAQD,GAyCxB,SAASE,EAAuBC,GAE5BC,EAAEC,QAAQL,EAAGM,cAAe,SAAUC,GAClCH,EAAEC,QAAQE,EAAMC,OAAQ,SAAUC,GAC9BL,EAAEC,QAAQF,EAAY,SAAUO,GAU5C,IAA0BA,EAAOD,EATbC,EAAM3B,OAAS0B,EAAiBC,QAS1BA,EARWA,EAQJD,EARWA,EASxCE,QAAQC,IAAIF,EAAOD,GACnBL,EAAEC,QAAQK,EAAMG,MAAO,SAAUC,GACzBL,EAAiBI,MAAMC,EAAU/B,OACjCqB,EAAEW,OAAOD,EAAWL,EAAiBI,MAAMC,EAAU/B,gBAvDjEgB,EAAQiB,MAAMC,KAAK,WACf,IACI,IAAIX,EAAgBY,KAAKC,MAAMpB,EAAQqB,SAAS,6BAClD,MAAOhD,GACLuC,QAAQU,MAAM,6BAA8BjD,GAEhD4B,EAAGM,cAAgBA,IAIvBR,EAAOwB,OAAO/B,QAAQgC,KAAKC,KAAM,WAC7B,OAAOxB,EAAGyB,eACV,SAAUC,GACKA,EAEf,IAAIC,GAAc,EAElBvB,EAAEC,QAAQL,EAAGM,cAAe,SAAUsB,GAClCxB,EAAEC,QAAQuB,EAAaC,OAAQ,SAAUC,GACrC1B,EAAEC,QAAQqB,EAAgBK,YAAa,SAAUC,GAC7C5B,EAAEC,QAAQ2B,EAAS,SAAUC,GACrBA,EAAcC,YAAYC,aAAeL,EAAOM,MAAQH,EAAcC,YAAYG,kBAAoBP,EAAOQ,KAC7G3B,QAAQC,IAAI,iEACZe,GAAc,WAO9BA,GACAzB,EAAuBwB,EAAgBvB,kBA6BjD,IAAIoC,EAAE,CAAC,SAAS5D,EAAQU,EAAOJ,GACjC,aACAN,EAAQ,2BACN,CAAC6D,yBAAyB,KAAK,GAAG,CAAC","file":"controllers-alrosa.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\nvar app = angular.module('app');\n\napp.directive('replaceWith', function () {\n    return {\n        scope: false,\n        controllerAs: 'replaceWith',\n        bindToController: true,\n        scopeAs: 'vm',\n        controller: 'isRouteController'\n    }\n});\n\napp.controller('isRouteController', ['$scope', 'backend', isRouteController]);\n\nfunction isRouteController($scope, backend) {\n    var vm = $scope.$parent.vm;\n    var searchResult = null;\n\n\n    backend.ready.then(function () {\n        try {\n            var redefineRules = JSON.parse(backend.getAlias('web.brandConfig.redefine'));\n        } catch (e) {\n            console.error('redefine rules parse error', e);\n        }\n        vm.redefineRules = redefineRules;\n\n    });\n\n    $scope.$watch(angular.bind(this, function () {\n        return vm.searchResult\n    }), function (newSearchResult) {\n        searchResult = newSearchResult;\n\n        var replaceInfo = false;\n\n        _.forEach(vm.redefineRules, function (redefineRule) {\n            _.forEach(redefineRule.routes, function (flight) {\n                _.forEach(newSearchResult.segmentRows, function (segment) {\n                    _.forEach(segment, function (segmentFlight) {\n                        if (segmentFlight.flightsInfo.origincity === flight.from && segmentFlight.flightsInfo.destinationcity === flight.to) {\n                            console.log('we redefine some rules here, head to web.brandConfig.redefine');\n                            replaceInfo = true;\n                        }\n                    })\n                })\n            });\n        });\n\n        if (replaceInfo) {\n            replaceInfoInBrandList(newSearchResult.brandsList);\n        }\n\n    });\n\n\n    function replaceInfoInBrandList(brandsList) {\n\n        _.forEach(vm.redefineRules, function (rules) {\n            _.forEach(rules.brands, function (replaceWithBrand) {\n                _.forEach(brandsList, function (brand) {\n                    if (brand.code === replaceWithBrand.brand) {\n                        replaceBrandInfo(brand, replaceWithBrand)\n                    }\n                })\n            });\n        })\n    }\n\n\n    function replaceBrandInfo(brand, replaceWithBrand) {\n        console.log(brand, replaceWithBrand);\n        _.forEach(brand.props, function (brandProp) {\n            if (replaceWithBrand.props[brandProp.code]) {\n                _.extend(brandProp, replaceWithBrand.props[brandProp.code]);\n            }\n        })\n    }\n}\n},{}],2:[function(require,module,exports){\n\"use strict\";\nrequire('./directives/withRoute');\n},{\"./directives/withRoute\":1}]},{},[2]);\n"]}